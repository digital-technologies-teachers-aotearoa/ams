{% extends "base.html" %}

{% load i18n static %}
{% load crispy_forms_tags %}

{% block title %}
  {% trans "Add Seats" %} - {{ organisation.name }}
{% endblock title %}

{% block content %}
  <div class="container my-5"
       data-prorata-cost-per-seat="{{ prorata_cost_per_seat }}"
       {% if max_charged_seats %}data-max-charged-seats="{{ max_charged_seats }}"{% endif %}
       {% if current_chargeable_seats %}data-current-chargeable-seats="{{ current_chargeable_seats }}"{% endif %}>
    <div class="row">
      <div class="col-12 col-md-8 offset-md-2">
        <h1>{% trans "Add Seats to" %} {{ organisation.name }}</h1>
        <!-- Current Membership Info -->
        <div class="alert alert-info mb-4">
          <h5 class="alert-heading">{% trans "Current Membership" %}</h5>
          <div class="row">
            <div class="col-12 col-md-6">
              <p class="mb-1">
                <strong>{% trans "Type:" %}</strong> {{ active_membership.membership_option.name }}
              </p>
              <p class="mb-1">
                <strong>{% trans "Expiry:" %}</strong> {{ active_membership.expiry_date|date:"d/m/Y" }}
              </p>
            </div>
            <div class="col-12 col-md-6">
              <p class="mb-1">
                <strong>{% trans "Current Seats:" %}</strong> {{ current_seats }}
              </p>
              {% if max_charged_seats %}
                <p class="mb-1">
                  <strong>{% trans "Charged Seats:" %}</strong> {{ current_chargeable_seats }} / {{ max_charged_seats }}
                </p>
                <p class="mb-1">
                  <strong>{% trans "Free Seats:" %}</strong> {{ active_membership.free_seats }}
                </p>
              {% endif %}
              <p class="mb-1">
                <strong>{% trans "Occupied:" %}</strong> {{ occupied_seats }}
              </p>
              {% if seats_available is not None %}
                <p class="mb-1">
                  <strong>{% trans "Available:" %}</strong> {{ seats_available }}
                </p>
              {% endif %}
            </div>
          </div>
        </div>
        <!-- Pro-Rata Info -->
        <div class="alert alert-warning mb-4">
          <h5 class="alert-heading">{% trans "Pro-Rata Pricing" %}</h5>
          <p class="mb-2">{% trans "Additional seats will be charged pro-rata based on the remaining membership period." %}</p>
          <p id="prorata-preview" class="mb-0 fs-5 fw-bold">{% trans "Enter number of seats to see the cost." %}</p>
        </div>
        <!-- Form -->
        {% crispy form %}
        <!-- Seats Breakdown -->
        <div id="seats-breakdown" class="alert alert-warning d-none">
          <h5 class="alert-heading">{% trans "Seats Breakdown" %}</h5>
          <p class="mb-1">
            <strong>{% trans "Seats being added:" %}</strong> <span id="breakdown-total">0</span>
          </p>
          <p class="mb-1">
            <strong>{% trans "Charged seats:" %}</strong> <span id="breakdown-chargeable">0</span>
          </p>
          <p class="mb-1">
            <strong>{% trans "Free seats:" %}</strong> <span id="breakdown-free">0</span>
          </p>
        </div>
      </div>
    </div>
  </div>
  <!-- JavaScript for live pro-rata calculation -->
  <script src="{% static 'js/membership_calculator.js' %}"></script>
  <script src="{% static 'js/organisation_add_seats.js' %}"></script>
{% endblock content %}
