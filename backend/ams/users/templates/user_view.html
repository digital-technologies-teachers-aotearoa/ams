{% extends "base.html" %}
{% load static wagtailcore_tags i18n %}
{% load render_table from django_tables2 %}

{% block title %}{% translate "User Account" %}{% endblock title %}

{% block body_class %}user-view{% endblock %}

{% block content %}

{% include "show_messages.html" %}

<table style="width: 100%">
    <tr>
        <td valign="top" style="padding: 10px">
            <img class="user-details-profile-image" src="{% if user_detail.profile.image %}/media/{{user_detail.profile.image}}{% endif %}">
            <h1>
                {% if user_detail.first_name %}
                    {{user_detail.get_full_name}}
                {% else %}
                    {{user_detail.username}}
                {% endif %}
            </h1>
            <div class="content">
                <p><a href="mailto:{{user_detail.email | urlencode}}">{{user_detail.email}}</a></p>

                <p><label>{% translate "Account Number" %}:</label>
                <br>{{ user_detail.account.pk }}</p>

                <p><label>{% translate "Join Date" %}:</label>
                <br>{{ user_detail.date_joined | date:"SHORT_DATE_FORMAT" }}</p>

                <a href="{% url "edit-user-profile" user_detail.pk %}">{% translate "Edit Profile" %}</a>
                <br><a href="javascript:{}" onclick="$('#profile_image_file').click();">
                    {% translate "Upload Profile Image" %}
                </a>
                <form method="post" enctype="multipart/form-data" id="upload_profile_image_form" action="">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="upload_profile_image">
                    <input type="file" id="profile_image_file" name="profile_image_file" style="display: none" accept="image/gif, image/png, image/jpeg">
                </form>
            </div>
        </td>
        <td valign="top">
            <h1>{% translate "Memberships" %}</h1>
            <div class="row">
                <div class="col-lg-12">
                    <div class="table-container">
                        <div class="table-actions">
                            {% if can_add_membership %}
                                <a class="btn btn-small btn-table-action" href="{% url "add-user-membership" user_detail.pk  %}">{% translate "Add Membership" %}</a>
                            {% endif %}
                        </div>
                        {% render_table tables.0 %}
                    </div>
                </div>
            </div>

            {% if tables.1.rows %}
            <br>
            <h1>{% translate "Invoices" %}</h1>
            <div class="row">
                <div class="col-lg-12">
                    <div class="table-container">
                        <div class="table-actions">
                        </div>
                        {% render_table tables.1 %}
                    </div>
                </div>
            </div>
            {% endif %}

            <br>
            <h1>{% translate "Organisations" %}</h1>
            <div class="row">
                <div class="col-lg-12">
                    <div class="table-container">
                        <div class="table-actions">
                        </div>
                        {% render_table tables.2 %}
                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>

<script>
    $('#profile_image_file').change(function() {
        $('#upload_profile_image_form').submit();
    });
</script>

{% if user.is_staff %}
    {% include "cancel_membership_modal.html" with modal_id="cancelMembershipModal" %}
{% endif %}

{% endblock content %}